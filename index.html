<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Trump Cards</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:600|Press+Start+2P&display=swap" rel="stylesheet">
    
    <script
    src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
    crossorigin="anonymous"></script>
    
    <script src="https://unpkg.com/infinite-scroll@3/dist/infinite-scroll.pkgd.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  </head>

  <body>
      <main role="main">
          <div class="jumbotron mt-2">
              <div class="container">
                  <div class="row">
                      <div class="col">
                          <h1 class="jumbotron-title">Trump Cards</h1>
                      </div>
                  </div>
                  <div class="row">
                      <div class="col">
                          <p class="jumbotron-description">
                              (Work in progress...)
                          </p>
                      </div>
                  </div>
                  <div class="row">
                    <div class="col">
                        <button type="button" class="btn btn-primary" id="CreateGame">
                            Create a game
                        </button>
                    </div>
                    <div class="col">
                        <div class="row">
                            <div class="col">
                                <input id="GameIdInput" class="form-control" placeholder="????????-????-????-????-????????????"></input>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-primary" id="JoinGame">
                                    Join a game
                                </button>
                            </div>
                        </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col" id="GameId">

                    </div>
                  </div>
              </div>
          </div>
      </main>
      
      <script type="text/javascript">

        var peer = null;
        var peerId = null;
        var conn = null;
        var opponent = {
            peerId: null
        };

        const createGame = document.getElementById('CreateGame');
        createGame.onclick = () => {
            create();
        };

        function create() {
            init();
            peer.on('open', function() {
                document.getElementById('GameId').innerHTML = "Game ID: " + peerId;
            });
            peer.on('connection', function(c) {
               if(conn) {
                c.close();
                return;
               }
               conn = c;
               begin();
            });
        };

        function init() {
            peer = new Peer();
            peer.on('open', function(id) {
                peerId = id;
            });
            peer.on('error', function(err) {
                alert('' + err);
            });
        };
        
        const joinGame = document.getElementById('JoinGame');
        joinGame.onclick = () => {
            join();
        };

        function join() {
            init();
            peer.on('open', function() {
                var destId = document.getElementById('GameIdInput').value;
                conn = peer.connect(destId);
                conn.on('open', function() {
                    opponent.peerId = destId;
                    begin();
                });
            });
        };

        function begin() {
            alert('hit begin()');
            conn.on('data', function(data) {
                switch(data[0]) {
                    case 'move':
                        if(turn) {
                            return;
                        }
                        var i = data[1];

                        // do something with data received from opponent;
                };
            });
            conn.on('close', function() {
                // connection closed - game over :(
            });
            peer.on('error', function(err) {
                alert('' + err);
            });
        };

      </script>
  </body>
</html>
